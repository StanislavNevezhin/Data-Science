# Итоговая работа Невежина Станислава по Проекту 3. О вкусной и здоровой пище.  
## Юнит 3. Введение в машинное обучение  
### skillfactory_rds  
![https://img.shields.io/badge/Python-3.7.4-blue](https://img.shields.io/badge/Python-3.7.4-blue)

## Оглавление  
[1. Описание модуля](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Описание-модуля)  
[2. Какой кейс решаем?](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Какой-кейс-решаем?)  
[3. Краткая информация о данных](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Краткая-информация-о-данных)  
[4. Полное описание задания с kaggle](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Полное-описание-задания-с-kaggle)  
[5. Шаблон ноутбука с параметрами модели](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Шаблон-ноутбука-с-параметрами-модели)  
[6. Краткое описание проделанной работы](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Краткое-описание-проделанной-работы)  
[7. Результат](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Результат)  


### Описание модуля  
Что вы получите в результате работы?  
- создадите свою первую модель, основанную на алгоритмах машинного обучения.
- примете участие в соревновании на Kaggle.
- поймете как правильно "готовить" данные, чтобы ваша модель работала лучше.  

***Чем мы будем заниматься?***  
В этом модуле вы попробуете решить свой первый настоящий кейс и создадите первую модель, использующую алгоритмы машинного обучения.  
Не пугайтесь, вам не придётся совершать академический подвиг и изучать машинное обучение в экстремально короткие сроки! На самом деле код для создания и обучения модели мы вам предоставим в готовом виде, и этот код будет довольно простым: в нём не будет предусмотрен подбор параметров и тонкая настройка модели (всему этому вы научитесь позже, в курсе по ML). Пока ваша задача будет состоять в том, чтобы качественно подготовить данные для обучения модели. Скоро вы убедитесь, что тщательная очистка данных и генерация новых признаков (Feature Engineering ) способны повысить точность модели в 2 и более раз, и владение этими навыками играют в машинном обучении не меньшую роль, чем умение выбрать алгоритм и настроить модель.  
Итак, факт остается фактом: свою первую модель вы создадите уже через пару недель, а после этого, в следующие две недели, используете свои наработки для участия в первом в вашей жизни соревновании на платформе Kaggle.com  
:arrow_up:[к оглавлению](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Оглавление)

### Какой кейс решаем?
Представьте, что Вы работаете DS в компании TripAdvisor. Одна из проблем TripAdvisorа — это нечестные рестораны, которые накручивают себе рейтинг. Одним из способов нахождения таких ресторанов, является построение модели, которая предсказывает рейтинг ресторана. Если предсказания модели сильно отличаются от фактического результата, то, возможно, ресторан играет нечестно, и его стоит проверить.

### Краткая информация о данных
В этом модуле вы будете работать с датасетом, содержащим сведения о 40 000 ресторанах Европы, а модель, которую вы будете обучать, должна будет предсказывать рейтинг ресторана по данным сайта TripAdvisor на основе имеющихся в датасете данных.  
Датасет представлен в репозитории в папке [**data** ](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/data)  

:arrow_up:[к оглавлению](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Оглавление)

### Полное описание задания с kaggle  
В этом соревновании вам будет предложен датасет, содержащий сведения о ресторанах. С помощью имеющего в вашем распоряжении кода, вам необходимо создать модель, использующую алгоритм RandomForestRegression, которая будет прогнозировать рейтинг ресторана по версии TripAdvidor.  
Для победы в конкурсе вам необходимо качественно очистить датасет, подобрать подходящие значения для заполнения пропусков и создать новые признаки на основе той информации, которую вы сможете извлечь из имеющихся в вашем распоряжении данных.  
Условия соревнования:  
- Все участники должны использовать один и тот же алгоритм с параметрами, заданными по умолчанию.  
- Разрешено использовать внешние данные.  
- Решения буду проверяться преподавателями на их адекватность и воспроизводимость.  

Во вкладке Notebooks этого соревнования для Вас доступно Базовое решение (Baseline)
:arrow_up:[к оглавлению](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Оглавление)

### Шаблон ноутбука с параметрами модели  
Базовое решение (Baseline) содержит настройки для модели (RandomForestRegression) == ```model = RandomForestRegressor(n_estimators=100, verbose=1, n_jobs=-1, random_state=RANDOM_SEED)```  
Полностью ноутбук с базовым решением (Baseline) можно посмотреть [по ссылке](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/baseline_notebook).  

:arrow_up:[к оглавлению](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Оглавление)

### Краткое описание проделанной работы
Общие принципы оформления ноутбука и реализации проекта:  
- основной упор сделан на Cleaning and Prepping Data, Exploratory Data Analysis, а также Feature Engineering;  
- некоторые прокомментированные ранее однотипные блоки кода, не комментировались повторно;
- закоментированы блоки кода, приводящие к увеличению Mean Absolute Error модели;
- исключено использование парсинга в данном проекте, детально изучались подготовка данных для модели Random Forest и специфика ее работы;  
- осуществлена оценка тональности отзывов с использованием векторов Bag of Words (BOW), а также методов CountVectorizer+RandomForestRegressor+Pipeline из библиотеки sklearn.

Этапы работ и главные моменты их реализации:
Импорт данных  
Предварительный анализ данных (pandas_profiling)  
Детальный анализ по переменным  
  0. Restaurant_id (номер ресторана Restaurant_id присваивается в соответствии с Ranking, удален)
  1. City (города, в которых располагаются рестораны, соотнесены со странами, созданы новые признаки на основе информации из внешних источников: является ли город столицей; количество его жителей; широта и долгота, в которых расположен город; ВВП стран, в которых расположен город (по ППС) на душу населения; кол-во ресторанов в городе, кол-во ресторанов на человека в городе; количество ресторанов в стране, а также коэффициент сосредоточенности ресторанов в городах страны)
  2. Cuisine Style (добавлен признак с количеством представленных стилей кухонь в ресторане)  
  3. Ranking (с помощью интерактивных графиков plotly были предложены новые признаки, которые вошли топ-10 по важности для модели: относительный ранг ресторана, равный отношению ранга ресторана к кол-ву ресторанов в городе; нормализованный ранг ресторана)  
  5. Price Range (заполнены значения в переменной по словарю, пропущенные значения заполнены медианным параметром цены)
  6. Number of Reviews (с помощью интерактивных графиков plotly были предложены новые признаки, которые вошли топ-10 по важности для модели: количество отзывов о ресторанах в городе; ранг ресторана относительно количества отзывов о ресторанах в городе) 
  7. Reviews (работа с датами с помощью регулярных выражений и библиотеки datetime, погружение в историю компании TrippAdvisor для анализа выбросов по порогу и создания новых признаков, таких как информация о том, насколько давно был сделан последний отзыв, перерыв между отзывами (по двум отзывам), день недели и год последнего отзыва). 
  Тональность отзывов распределена на основе рейтинга ресторана по трем категориям (-1 негативная, 0 нейтральная, +1 позитивная), рассмотрены методы оценки тональности отзывов (BOW, TF-IDF, Word2vec), проведены токенизация текста, стемизация токенов, созданы словарь и вектора BOW, произведено обучение модели и классификация отзывов с помощью инструментов Gensim – библиотеки обработки естественного языка. На основе тестов установлено, что наибольшую точность классификации обеспечивает использование метода BOW. В качестве альтернативы рассмотрена комбинация методов CountVectorizer+RandomForestRegressor+Pipeline из библиотеки sklearn.
  8. ID_TA  
  9. URL_TA  
  10. Создание модели (рассмотрены корреляции полученных признаков с помощью heatmap; добавлен категорийный признак стили кухонь ресторанов с помощью MultiLabelBinarizer; информация о городах и странах преобразована в dummy-переменные; удалены нечисловые критерии; осуществлена азбивка датасета на тренировочный и тестовый)
  Произведены обучение модели, генерация результата и сравнивнение с тестом (train_test_split, RandomForestRegressor, MAE из sklearn). Выделены наиболее важные параметры модели.  
  Submission  
:arrow_up:[к оглавлению](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Оглавление)


### Результат  
- score - 0.16600
- на 15.06.2020 10 место из 102 участников (Тор 10%)   
- [ноутбук на kaggle](https://www.kaggle.com/stanislavnevezhin/intro-ml-v6-1)  
:arrow_up:[к оглавлению](https://github.com/StanislavNevezhin/skillfactory_rds/tree/master/module_3/README.md#Оглавление)